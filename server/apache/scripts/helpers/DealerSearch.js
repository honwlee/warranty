/**
 * warranty - 
 * @author 
 * @version v0.0.0
 * @link 
 * @license 
 */
define(["skylarkjs","server","./Partial","./formModal","./itemActions","toastr","jquery","handlebars"],function(e,t,n,i,a,r,o,d){var c,s=e.langx;return s.Evented.inherit({klassName:"DealerSearch",doAction:!1,init:function(e){e=e||{},this.doAction=e.doAction},search:function(e,a){var r=this;t().connect("dealers","get","list?cityId="+e).then(function(e){var t=a.find("#dealerData").find("table").empty();if(e&&e.length>0){t.removeClass("hide");var c=o("<thead>").attr({"class":"text-center"}).appendTo(t),s=o("<tbody>").appendTo(t);o("<tr>").html("<th class='--i18n--' data-i18n-key='company'>公司名称</th><th class='--i18n--' data-i18n-key='address'>地址</th>"+(this.doAction?"<th class='--i18n--' data-i18n-key='operate'>操作</th>":"")).appendTo(c),n.get("dealer-tr-partial"),e.forEach(function(e){var t=d.compile("{{> dealer-tr-partial}}"),n=o(t(e)).appendTo(s);this.doAction?n.delegate("td.td-action .btn","click",function(t){var a=o(t.target).data("action");"edit"===a?i.show("dealer",e,function(e){n.find(".company").html(e.company),n.find(".address").html(e.address)}):r.remove(e,function(){n.remove()})}):n.find("td.td-action").remove()}),a.find(".no-result").addClass("hide")}else a.find(".no-result").removeClass("hide");r.trigger("searched")})},preparing:function(e){var n=this;return t().getProvinces().then(function(e){n._buildDom(e)})},remove:function(e,n){o("#confirmDeleteModal").modal("show").on("click",".btn-ok",function(i){t().connect("dealer","post","delete",{id:e.id}).then(function(){n(),o("#confirmDeleteModal").modal("hide")})})},getPrepareData:function(){return c},_buildDom:function(e){n.get("dealer-search-partial");var i=this,a=d.compile("{{> dealer-search-partial}}"),c=o("<div>").html(a({provinces:e})),s=this.selector=o(c[0].firstChild),l=s.find("#cityS");s.find("#provinceS").on("change",function(){return this.value?void t().getCities(this.value,l).then(function(){i.trigger("citiesLoaded")}):r.warning("请选择省份！")});var h=function(){var e=l.val();return e?(i.search(e,s),void s.find(".panel-heading").removeClass("hide")):r.warning("请选择城市！")};return s.find("#searchDealerBtn").on("click",h),s.off("keypress").on("keypress",function(e){13===e.keyCode&&h()}),this.selector},getDom:function(){return this.selector}})});